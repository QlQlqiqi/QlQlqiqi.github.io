# 第三次作业

| 学号        | 姓名   | 班级           |
| ----------- | ------ | -------------- |
| 19030100358 | 吴起龙 | 周一上午1、2节 |

> 作业要求

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20220330164356115.png" alt="image-20220330164356115" style="zoom:33%;" />

> 环境：
>
> 1. 中间件 gRPC
> 2. 环境 nodejs

1、调用关系

- 服务器运行 gRPC 相应模块，在特定端口暴露相应方法。
- 客户端通过 gRPC 相应模块，携带参数向特定域名请求特定方法，然后等待服务器执行完毕后通过 gRPC 返回结果。

2、具体实现

1. 因为 gRPC 是跨语言中间件，所以数据类型以 proto 为准。（代码见 ./code/library.proto）
2. 服务器先绑定相应的 .proto 文件，规定相应数据格式和操作方式；然后在特定端口暴露相应方法；启动服务器。
3. 客户端向告诉 gRPC 域名，然后本地调用方法，gRPC 会通过 TCP 进行远程调用，并返回结果。

3、tips&bugs

- 因为服务器需要可以并发访问的能力，所以要对数据库共享数据进行上锁，我这里用的是**二段锁协议**。
- 如果讲请求来的任务分配给不同的进程（worker）执行，可以大大增加并发量。
- 由于汉字占多个字节，所以数据发送时可能会从中间截断，导致数据乱码，使用 Buffer 对数据进行拼接， 可以很好的解决这个问题。

4、运行结果

> 客户端查询

![image-20220331181111252](https://s2.loli.net/2022/03/31/zJZli93HN5tqKah.png)

> 代码见 ./code
